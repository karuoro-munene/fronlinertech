{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Front Liner Tech - Sign Up</title>

    <!-- Font Icon -->
    <link rel="stylesheet"
          href="{% static 'registration/fonts/material-icon/css/material-design-iconic-font.min.css' %}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <!-- Main css -->
    <link rel="stylesheet" href="{% static 'registration/css/style.css' %}">
    <style>
        .red{
        color:red;
        text-align:right;
        padding-bottom:0;
        }
        .green{
        color:#00FF00!important;
        }
    </style>

</head>
<body>
<div class="main">
    <!-- Sign up form -->
    <section class="signup">
        <div class="container">
            <div class="signup-content">
                <div class="signup-form">
                        <h2 class="">Sign up</h2><br>
                    <form method="POST" class="register-form" id="register-form">
                        {% csrf_token%}
                        <div class="form-group">
                            <div class="red"><small id="username_error"></small></div>
                            <label for="id_username"><i class="zmdi zmdi-account material-icons-name"></i></label>
                            <input type="text" name="username" maxlength="32" autofocus required id="id_username"
                                   placeholder="Enter Username"/>
                        </div>
                        <div class="form-group">
                            <div class="red"><small id="email_error"></small></div>
                            <label for="id_email"><i class="zmdi zmdi-email"></i></label>
                            <input type="email" name="email" maxlength="64" required id="id_email"
                                   placeholder="Your Email"/>
                        </div>
                        <div class="form-group">
                            <div class="red"><small id="phonenumber_error"></small></div>
                            <label for="id_phonenumber"><i class="fa fa-phone"></i></label>
                            <input type="number" name="phonenumber" maxlength="14" required id="id_phonenumber"
                                   placeholder="Mpesa Number"/>
                        </div>
                        <div class="form-group">
                            <div class="red"><small id="password1_error"></small></div>
                            <label for="id_password1"><i class="zmdi zmdi-lock"></i></label>
                            <input type="password" name="password1" required id="id_password1" placeholder="Password"/>
                        </div>
                        <div class="form-group">
                            <div class="red"><small id="password2_error"></small></div>
                            <label for="id_password2"><i class="zmdi zmdi-lock-outline"></i></label>
                            <input type="password" name="password2" required id="id_password2"
                                   placeholder="Repeat your password"/>
                        </div>
                        <div class="form-group">
                            <div class="red"><small id="terms_error"></small></div>
                            <input type="checkbox" name="agree-term" id="agree-term" class="agree-term"/>
                            <label for="agree-term" class="label-agree-term"><span><span></span></span>I agree all
                                statements in <a href="#" class="term-service">Terms of service</a></label>
                        </div>
                        <div class="form-group form-button">
                            <input type="submit" name="signup" id="signup" class="form-submit" value="Register"/>
                        </div>
                    </form>

                </div>
                <div class="signup-image">
                    <figure><img src="{% static 'registration/images/signup.svg' %}" alt="sing up image"></figure>
                    <a href="{%url 'signin' %}" class="signup-image-link">I am already member</a>
                </div>

            </div>
        </div>
    </section>

</div>

<!-- JS -->
<script src="{% static 'registration/vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'registration/js/main.js' %}"></script>
<script>
    $("#id_username").change(function () {
      console.log( $(this).val() );
      var username = $(this).val();

      $.ajax({
        url: '/accounts/validate_username/',
        data: {
          'username': username
        },
        dataType: 'json',
        success: function (data) {
          if (data.is_taken) {
            $("#username_error").html("Username already taken!");
            $("#id_username").css("color", "red");

          }
          else{
            console.log("Username is available");
            $("#username_error").html("<i class='fa fa-check green' ></i>");
            $("#id_username").css("color", "#00FF00");
          }
        }
      });

    });

  </script>
<script>
    function validateEmail($email) {
          var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
          return emailReg.test($email);
        }

    function validatePassword($password) {
          var emailReg = /^[@$!%*#?&A-Za-z\d]{8,}$/;
          return emailReg.test($password);
        }

    function validateSafaricom($number){
          var safaricomReg = /(^0)((7(([0-2]{1}[0-9]{1})|([9]{1}[0-9]{1})|([4]{1}[0-3]{1})|([4]{1}[5-6]{1})|([4]{1}[8]{1})|([5]{1}[7-9]{1})|([6]{1}[8-9]{1})))|(1([1]{1}[0-9]{1})))[0-9]{6}$/;
          return safaricomReg.test($number);
        }

    $("#id_email").change(function () {
    var email =  $(this).val();
        if ( !validateEmail(email)) {
            $("#email_error").html("Not a valid email!");
            $("#id_email").css("color", "red");
        }
        else{
            $("#email_error").html("<i class='fa fa-check green' ></i>");
            $("#id_email").css("color", "#00FF00");
        }
    });

    $("#id_phonenumber").change(function () {
        var number =  $(this).val();
        if ( !validateSafaricom(number)) {
            $("#phonenumber_error").html("Not a valid Mpesa number!");
            $("#id_phonenumber").css("color", "red");
        }
        else{
            $("#phonenumber_error").html("<i class='fa fa-check green' ></i>");
            $("#id_phonenumber").css("color", "#00FF00");
        }
    });

    $("#id_password1").change(function () {
        var password =  $(this).val();
        if ( !validatePassword(password)) {
            console.log('Must be 8 characters or longer with no spaces!');
            $("#password1_error").html("Must be 8 characters or longer with no spaces!");
            $("#id_password1").css("color", "red");
        }
        else{
            $("#password1_error").html("<i class='fa fa-check green' ></i>");
            $("#id_password1").css("color", "#00FF00");
        }
    });

    $("#id_password2").change(function () {
        var password1 =  $("#id_password1").val();
        var password2 =  $(this).val();
        if ( password1!=password2) {
            console.log('Passwords do not match!');
            $("#password2_error").html("Passwords do not match!");
            $("#id_password2").css("color", "red");
        }
        else{
            $("#password2_error").html("<i class='fa fa-check green' ></i>");
            $("#id_password2").css("color", "#00FF00");
        }
    });

</script>
<script>
var is_checked = $('#agree-term').is(":checked");
    if (is_checked){
        $("#terms_error").html("");
    }
$( "#register-form" ).submit(function( event ) {
    var is_checked = $('#agree-term').is(":checked");
    if (is_checked){
        $("#terms_error").html("");
        $( "#register-form" ).submit();
    }
    else{
        $("#terms_error").html("Must agree to terms first!");
        event.preventDefault();
    }
});
</script>

</body>

</html>
